{% extends 'base.html.twig' %}

{% block title %}Synthèse RH – Tableau filtré{% endblock %}

{% block body %}
<div class="container py-4">
    <h2>Synthèse des primes de performance</h2>
    <form method="get" class="row g-3 mb-3">
        <div class="col-md-3">
            <select name="periode" class="form-select">
                <option value="">Toutes périodes</option>
                {% for p in periodes %}
                    <option value="{{ p.id }}" {{ p.id == periodeId ? 'selected' : '' }}>
                        {{ p }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <select name="division" class="form-select">
                <option value="">Toutes divisions</option>
                {% for d in divisions %}
                    <option value="{{ d.id }}" {{ d.id == divisionId ? 'selected' : '' }}>
                        {{ d.nom }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <select name="statut" class="form-select">
                <option value="">Tous statuts</option>
                <option value="draft" {{ statut == 'draft' ? 'selected' : '' }}>En brouillon</option>
                <option value="submitted" {{ statut == 'submitted' ? 'selected' : '' }}>Soumise</option>
                <option value="service_validated" {{ statut == 'service_validated' ? 'selected' : '' }}>Validée Service</option>
                <option value="division_validated" {{ statut == 'division_validated' ? 'selected' : '' }}>Validée Division</option>
            </select>
        </div>
        <div class="col-md-3 d-flex">
            <button type="submit" class="btn btn-primary me-2">Filtrer</button>
            <a href="{{ path('rh_tableau_synthese', app.request.query.all | merge({'export': 'xlsx'})) }}" class="btn btn-outline-success me-2">
                Export Excel
            </a>
            <a href="{{ path('rh_tableau_synthese', app.request.query.all | merge({'export': 'pdf'})) }}" class="btn btn-outline-danger">
                Export PDF
            </a>
        </div>
    </form>

    <table class="table table-bordered table-sm align-middle">
        <thead>
            <tr>
                <th>Matricule</th>
                <th>Nom</th>
                <th>Période</th>
                <th>Division</th>
                <th>Service</th>
                <th>Statut</th>
                <th>Montant</th>
            </tr>
        </thead>
        <tbody>
            {% for pp in primes %}
                <tr>
                    <td>{{ pp.employee.matricule }}</td>
                    <td>{{ pp.employee.getFullName() }}</td>
                    <td>{{ pp.periodePaie }}</td>
                    <td>{{ pp.employee.employeeSituations[0].service.division.nom ?? '' }}</td>
                    <td>{{ pp.employee.employeeSituations[0].service.nom ?? '' }}</td>
                    <td>{{ pp.status|capitalize }}</td>
                    <td>{{ pp.getMontantFormate() }}</td>
                </tr>
            {% else %}
                <tr><td colspan="7" class="text-center">Aucune donnée.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
